!function(){"use strict";const t=Math.round,e=Math.random,n=Math.sin,o=Math.cos,i=Math.atan2,a=Math.abs,s=Math.max,r=Math.min,h=Math.sqrt,l=Math.hypot,u=Math.PI,d=2*u;function f(n,o){return t(n+e()*(o-n))}function y(t,n){return t+e()*(n-t)}function p(t=0,e=0){return{x:t,y:e}}function g(t,e){return{x:e.x-e.x,y:e.y-t.y}}function x(t,e){const n=t.x-e.x,o=t.y-e.y;return n*n+o*o}function m(t){return l(t.x,t.y)}function w(t){const{x:e,y:n}=t;return e*e+n*n}function b(t,e){let n=m(t);n>0&&(n=e/n,t.x*=n,t.y*=n)}function v(t,e){let n=t>>24&255,o=t>>16&255,i=t>>8&255,a=255&t;return n=n*e.am+e.ao&255,o=o*e.rm+e.ro&255,i=i*e.gm+e.go&255,a=a*e.bm+e.bo&255,`rgba(${o}, ${i}, ${a}, ${n/255})`}const k={1:0,0:1};function A(t,e){return t===e||k[t]===e}function C(t,e,i,a,s,c){const r={x:a.speed*o(i),y:a.speed*n(i)};let h=0;const l=m(r),{length:u,width:d,color:f}=a,y=d/2,g={x:t,y:e,rotation:i,body:{weight:0,radius:3,transparent:!0},shape:[4,3,-u,0,0,-y,0,y,0,0],pallete:[f],onUpdate(t){this.x+=r.x*t,this.y+=r.y*t,h+=l*t,h>a.distance&&c.removeBullet(g)},onCollision(t,e){if("health"in t){const e=t;if(!A(e.type,s)&&(e.health-=a.damage/a.points.length,c.removeBullet(g),a.impulse)){const t=p(r.x,r.y);b(t,a.impulse),c.addImpulse({target:e,value:t})}}}};return g}function T(t,e){let i=0,a=0;return(s,c)=>{if(c&&t.settings.weapons){const c=t.settings.weapons[t.weapon];if(i-=s,i<=0){i=1/c.frequency;const{rotation:s,type:r}=t;if(c.angle){let i=s-c.angle/2;const a=c.angle/c.points.length;for(const s of c.points){const h=o(i),l=n(i),{x:u,y:d}=s,f=C(t.x+u*h-d*l,t.y+u*l+d*h,i,c,r,e);e.addBullet(f),i+=a}}else{a++,a>=c.points.length&&(a=0);const i=o(s),h=n(s),{x:l,y:u}=c.points[a],d=C(t.x+l*i-u*h,t.y+l*h+u*i,s,c,r,e);e.addBullet(d)}}}else i=0}}function U(t,i,a,s,c,r,h,l,y){let p=f(c,r);t.push(4,p);const g=d/p;for(void 0===y&&(y=u*e());p--;)t.push(a+n(y)*f(h,l),s+o(y)*f(h,l)),y+=g;t.push(0,i)}class M{constructor(t){this.actions={},this.transitions=[],this._state=-1,this._reactionTime=0,this._time=0,this._reactionTime=t}setState(t,e){this._state=t;const n=this.getAction();n&&n.start(e)}getAction(){const t=this.actions[this._state];if(!t)throw"Action not found: "+this._state;return t}update(t){const n=this.getAction();if(n&&n.update(t),this._time-=t,this._time<=0){this._time=this._reactionTime+this._reactionTime*e();for(const t of this.transitions){const{from:e,to:n}=t;if(n!==this._state&&(0===e.length||e.includes(this._state))&&t.condition()){this.setState(n,t.data);break}}}}}function S(t){const{radius:e,weight:n,color:o,type:i,health:a}=t,s=[o,4278190080],c=new M(t.reaction),r={radius:e,weight:n},h=[];return U(h,0,0,0,5,5,e,e,u/10),U(h,1,e/2,0,3,3,e/3,e/3,u/2),{type:i,shape:h,pallete:s,rotation:0,x:0,y:0,fsm:c,body:r,health:a,settings:t,weapon:0,onUpdate(t){this.fsm.update(t)}}}function B(t,i){const a=S(t),{walkSpeed:s}=t;a.rotation=d*e();const{fsm:c}=a,{actions:r,transitions:h}=c;return r[0]={update(t){a.rotation+=this.data.speed*t,this.data.time-=t},start(){this.data={speed:e()>.5?-1:1,time:y(.5,2)}}},r[1]={update(t){a.x+=this.data.speedX*t,a.y+=this.data.speedY*t,this.data.time-=t},start(){this.data={speedX:o(a.rotation)*s,speedY:n(a.rotation)*s,time:y(1,3)}}},r[3]={update(t){a.alpha-=t,a.alpha<0&&i.removeUnit(a)},start(){a.alpha=.9,a.body.enabled=!1}},h.push({from:[1],to:0,condition:()=>a.x<-500?(a.x+=5,!0):a.x>500?(a.x-=5,!0):a.y<-500?(a.y+=5,!0):a.y>500?(a.y-=5,!0):c.getAction().data.time<0},{from:[0],to:1,condition:()=>c.getAction().data.time<0},{from:[],to:3,condition:()=>a.health<=0}),c.setState(0),a}function D(t,e){return{damage:e,speed:100,points:[p(t,0)],frequency:1,distance:20,color:4294901760,length:20,width:20,impulse:3,sound:2}}function O(t){return{damage:20,points:[p(t,0)],frequency:3,speed:1e3,distance:1e3,color:4294967295,length:30,width:4,impulse:5,sound:1}}function W(t){return{damage:40,points:[p(t,-5),p(t,5)],frequency:10,speed:1500,distance:1e3,color:4294967040,length:50,width:3,impulse:3,sound:0}}function _(t){return{damage:150,points:new Array(10).fill(p(t,0)),frequency:1,speed:1e3,distance:300,color:4278255615,length:10,width:3,angle:.7,impulse:5,sound:3}}function $(t){var e;return(0,(e=[O,W,_])[f(0,e.length-1)])(t)}function K(t,e){const n=x(t,e),o=e.body.radius+t.body.radius;return n<1.1*(o*o)}function E(t){const a=y(25,45),s={type:2,radius:a,weight:3*a,health:4*a,color:4288217088,walkSpeed:y(80,150),reaction:.5,weapons:[D(a,a)]},c=B(s,t),{walkSpeed:r}=s,h=400;c.rotation=d*e();const{fsm:l}=c,{actions:u,transitions:f}=l,p=T(c,t);return u[5]={update(t){c.rotation=i(this.data.target.y-c.y,this.data.target.x-c.x);const e=o(c.rotation)*r,a=n(c.rotation)*r;c.x+=e*t,c.y+=a*t},start(t){this.data={target:t}}},u[4]={update(t){p(t,!0)},start(t){this.data={target:t}}},f.push({from:[0,1],to:5,condition(){const e=t.getNearOpponent(c,h);return!!e&&(this.data=e,!0)}},{from:[5,4],to:0,condition(){const e=l.getAction().data.target;if(e.health<=0)return!0;if(x(e,c)>24e4)return!0;return t.getNearOpponent(c,h)!=e}},{from:[5],to:4,condition(){const t=l.getAction().data.target;return!!K(t,c)&&(this.data=t,!0)}},{from:[4],to:5,condition(){const t=l.getAction().data.target;return!K(t,c)&&(this.data=t,!0)}}),c}function P(t){const e={type:1,radius:30,weight:90,health:100,color:4288256256,walkSpeed:200,reaction:.2,weapons:[$(30)]},n=B(e,t),{fsm:o}=n,{actions:a,transitions:s}=o,{units:c}=t,{walkSpeed:r}=e,h=200,l=T(n,t);return a[4]={update(t){const e=this.data.target;n.rotation=i(e.y-n.y,e.x-n.x);const o=function(t,e,n,o){let{x:i,y:a}=t,s=1;for(const c of e)if(!A(c.type,t.type)){const e=g(c,t);w(e)<o&&(b(e,n),i+=e.x,a+=e.y,s++)}return s>1?(i/=s,a/=s,{x:i,y:a}):null}(n,c,h,4e4);if(o){const e=g(n,o);w(e)>r&&(b(e,r),n.x+=e.x*t,n.y+=e.y*t)}l(t,!0)},start(t){this.data={target:t}}},s.push({from:[0,1],to:4,condition(){let e=t.getNearOpponent(n,h);return!!e&&(this.data=e,!0)}},{from:[4],to:0,condition(){const t=o.getAction().data.target;if(t.health<=0)return!0;return x(t,n)>6e4}}),n}const q=document,J="ontouchstart"in window,X=devicePixelRatio,Y={0:(t,e,n)=>{const o=n.fillStyle;e.width=t.width,e.height=t.height,n.fillStyle=o,n.fillRect(0,0,e.width,e.height)},1:(t,e,n)=>{n.fillStyle=function(t){return`rgba(${t>>16&255}, ${t>>8&255}, ${255&t}, ${(t>>24&255)/255})`}(t.color)},2:(t,e,n)=>{n.fillRect(t.x,t.y,t.width,t.height)},3:(t,e,n)=>{const o=t.width/2,i=t.height/2;n.beginPath(),n.ellipse(t.x+o,t.y+i,o,i,0,0,d),n.closePath(),n.fill()},5:(t,e,n,o)=>{const i=Y[o.type],a=o.x,s=t.stepX,c=t.stepY,r=t.cols;let h=t.count,l=1;for(o.x+=s;h--;)i(o,e,n,o),o.x+=s,l++,l===r&&(l=0,o.x=a,o.y+=c)},6:(t,n,o)=>{const i=t.colorOffset,a=i/2,s=o.getImageData(0,0,n.width,n.height),c=s.data;let r=0;for(;r<c.length;){const t=c[r],n=c[r+1],o=c[r+2];c[r]=t-a+i*e(),c[r+1]=n-a+i*e(),c[r+2]=o-a+i*e(),r+=4}o.putImageData(s,0,0)}};const I=[{type:1,color:4284900966},{type:0,width:512,height:512},{type:1,color:4286023799},{type:2,x:20,y:20,width:50,height:50},{type:5,stepX:70,stepY:70,count:48,cols:7},{type:1,color:4284900966},{type:2,x:140,y:140,width:220,height:220},{type:1,color:4286023799},{type:3,x:160,y:160,width:190,height:190}];function R(){const t=512,e={image:function(t){const e=q.createElement("canvas"),n=e.getContext("2d");let o;return t.forEach((t=>{(0,Y[t.type])(t,e,n,o),o=t})),e}(I),x:-256,y:-256},n=l(t)/2,o=[];for(let t=0;t<10;t++)for(let i=0;i<10;i++)o.push({x:511*(t-5),y:511*(i-5),radius:n,children:[e]});return{children:o}}const V=p();function F(){const t=[],e=[],n=[],o=[],i=[];return{units:e,children:[R(),{children:i,touchable:!1},{children:e,touchable:!1},{children:n,touchable:!1}],onUpdate(e){!function(t,e){for(let e=0;e<t.length;e++){const n=t[e],o=n.body;if(!1!==o.enabled)for(let i=e+1;i<t.length;i++){const e=t[i],a=e.body;if(!1!==a.enabled){const t=o.radius+a.radius,i=t*t;n.x==e.x&&n.y===e.y&&(n.x+=.001),V.x=n.x-e.x,V.y=n.y-e.y;const s=w(V);if(s<i){if(!o.transparent&&!a.transparent){o.points,a.points;const i=h(s),c=(t-i)/i,r=V.x*c,l=V.y*c;let u=0,d=0;if(o.static)d=1;else if(a.static)u=1;else{const t=o.weight,e=a.weight,n=t+e;u=e/n,d=t/n}n.x+=r*u,n.y+=l*u,e.x-=r*d,e.y-=l*d}(n.onCollision||e.onCollision)&&(V.x=n.x-e.x,V.y=n.y-e.y,b(V,a.radius),V.x+=e.x,V.y+=e.y),n.onCollision&&n.onCollision(e,V),e.onCollision&&e.onCollision(n,V)}}}}}(t),function(t,e){for(const n of t){const{target:o,value:i}=n;o.x+=i.x,o.y+=i.y;const{weight:a}=o.body;let s=m(i);s-=s*a/4*e,s<.5?t.splice(t.indexOf(n)):b(i,s)}}(o,e)},addObject(e){i.push(e),t.push(e)},removeObject(e){i.splice(i.indexOf(e),1),t.splice(t.indexOf(e),1)},addUnit(n){e.push(n),t.push(n)},removeUnit(n){e.splice(e.indexOf(n),1),t.splice(t.indexOf(n),1)},getUnitCount(t){let e=0;for(const n of this.units)n.type===t&&e++;return e},getNearOpponent(t,n){let o=null,i=n*n;for(const n of e)if(!A(n.type,t.type)&&n.health>0){const e=x(n,t);e<i&&(i=e,o=n)}return o},addBullet(e){n.push(e),t.push(e)},removeBullet(e){n.splice(n.indexOf(e),1),t.splice(t.indexOf(e),1)},addImpulse(t){o.push(t)}}}const H=[];const N=new AudioContext,j=1*(Math.exp(.5)-1);function z(t){const e=function(t){let e=0;const n=t[5],o=Math.abs(t[6]),i=t[6]>0,a=t[7],s=t[8],c=t[13],r=t[14],h=t[11],l=t[12];let u=n,d=a,f=c,y=r,p=l;const g=t[0];let x=t[18];const m=.1!==x,w=t[19],b=t[20];let v=t[21];const k=t[22],A=t[10],C=t[9],T=[t[1],t[2],t[4]],U=t[3];let M=t[16];const S=t[17],B=t[15];let D=0,O=0,W=0,_=new Float32Array(32);for(let t=0;t<32;++t)_[t]=2*Math.random()-1;let $=0,K=0,E=0,P=0,q=0,J=new Float32Array(1024);for(let t=0;t<1024;++t)J[t]=0;let X=[];for(let t=0;0!==B&&++e>=B&&(u=n,d=a,f=c,y=r,p=l),0!==p&&t>=p&&(p=0,u*=h),d+=s,u*=d,!(u>o&&(u=o,i));++t){let t=u;C>0&&(E+=A,t=u*(1+Math.sin(E)*C));let e=Math.floor(t);if(e<8&&(e=8),f+=y,f<0&&(f=0),f>.5&&(f=.5),++K>T[$]&&(K=0,++$>2))break;const n=K/T[$];let o;o=0===$?n:1===$?1+2*(1-n)*U:1-n,M+=S;let i=Math.abs(Math.floor(M));i>1023&&(i=1023),0!==k&&(v*=k,v<1e-5&&(v=1e-5),v>.1&&(v=.1));let a=0;for(let t=0;t<8;++t){let t=0;if(++P,P>=e&&(P%=e,3===g))for(let t=0;t<32;++t)_[t]=2*Math.random()-1;const n=P/e;0===g?t=n<f?.5:-.5:1===g?t=n<f?2*n/f-1:1-2*(n-f)/(1-f):2===g?t=Math.sin(2*n*Math.PI):3===g&&(t=_[32*P/e|0]);const s=D;x*=w,x<0&&(x=0),x>.1&&(x=.1),m?(O+=(t-D)*x,O-=O*b):(D=t,O=0),D+=O,W+=D-s,W-=W*v,t=W,J[1023&q]=t,t+=J[q-i+1024&1023],q=q+1&1023,a+=t*o}X.push(a*j/8)}return new Float32Array(X)}(t),n=N.createBuffer(1,e.length,44100);return n.copyToChannel(e,0,0),n}const L=[];class G{constructor(t){this.direction=p(),this.attack=!1,this.rotation=0,this.weapon=0,t.setActiveWeapon(this.weapon),t.gunButton.onClick=()=>{this.weapon=0,t.setActiveWeapon(t.gunButton)},t.rifleButton.onClick=()=>{this.weapon=1,t.setActiveWeapon(t.rifleButton)},t.shotgunButton.onClick=()=>{this.weapon=2,t.setActiveWeapon(t.shotgunButton)}}}class Q extends G{constructor(t,e){super(t),e.onTouchMove=t=>{this.rotation=i(t.y-this.player.y,t.x-this.player.x)},e.onTouchDown=t=>{this.attack=!0,function(t){L[t]||(L[t]=z(new Float32Array(H[t])));var e=N.createBufferSource();e.buffer=L[t],e.connect(N.destination),e.start()}(this.player.settings.weapons[this.weapon].sound)},e.onTouchUp=t=>{this.attack=!1};let n=!1,o=!1,a=!1,s=!1;const c=e=>{const i="keydown"===e.type;switch(e.code){case"KeyW":case"ArrowUp":n=i;break;case"KeyS":case"ArrowDown":o=i;break;case"KeyA":case"ArrowLeft":s=i;break;case"KeyD":case"ArrowRight":a=i;break;case"Space":i&&this.player.settings.weapons&&(this.weapon++,this.weapon>=this.player.settings.weapons.length&&(this.weapon=0),t.setActiveWeapon(this.weapon))}this.direction.x=0,this.direction.y=0,n&&(this.direction.y-=1),o&&(this.direction.y+=1),s&&(this.direction.x-=1),a&&(this.direction.x+=1),b(this.direction,1)};e.onKeyDown=c,e.onKeyUp=c}}class Z extends G{constructor(t){super(t),t.moveJoystick.onChange=()=>{var e,n;e=t.moveJoystick.value,(n=this.direction).x=e.x,n.y=e.y,b(this.direction,1)},t.attackJoystick.onChange=()=>{const{value:e}=t.attackJoystick;this.attack=t.attackJoystick.isActive(),this.attack&&(this.rotation=i(e.y,e.x))}}}function tt(t,e,n,o){let i=100;for(;;){t.x=y(n,o),t.y=y(n,o);let a=!0;for(const n of e)if(!A(n.type,t.type)&&x(t,n)<4e4){a=!1;break}if(a)break;if(i--<0)break}}function et(t){const e=p(),n=F(),o=function(t,e){return J?new Z(e):new Q(e,t)}(n,t),i=function(t,e){const n={type:0,radius:30,weight:90,health:100,color:4278229401,walkSpeed:200,reaction:.2,weapons:[O(30),W(30),_(30)]},o=S(n),{fsm:i}=o,{actions:a,transitions:s}=i,{walkSpeed:c}=n,r=T(o,t);return a[1]={update(t){const n=c*t;o.x+=e.direction.x*n,o.y+=e.direction.y*n,o.rotation=e.rotation,o.weapon=e.weapon,r(t,e.attack)},start(){}},a[3]={update(){},start(){o.alpha=.5,o.body.enabled=!1}},s.push({from:[],to:3,condition:()=>o.health<=0}),i.setState(1),o}(n,o);o.player=i,n.addUnit(i);const a=600;for(let t=0;t<30;t++){const t=E(n);tt(t,n.units,-600,a),n.addUnit(t)}const c=300;for(let t=0;t<10;t++){const t=P(n);t.x=y(-300,c),t.y=y(-300,c),n.addUnit(t)}const h=[];U(h,0,0,0,10,10,100,100);const u={x:512,y:0,rotation:0,pallete:[4284874854],shape:h,body:{weight:0,static:!0,radius:100}};n.addObject(u);return{camera:e,children:[n],size:2500,onUpdate(){if(n.getUnitCount(2)<30){const t=E(n);tt(t,n.units,-600,a),n.addUnit(t)}},updateCamera(){this.camera.x=i.x,this.camera.y=i.y,this.children?.forEach((t=>{n.x=-this.camera.x,n.y=-this.camera.y}))},calculateVolume(t){const n=(i=t,l((o=e).x-i.x,o.y-i.y));var o,i;return 1-r(1,s(0,n/1250))}}}function nt(t,e,n){const o=q.createElement("canvas");o.width=o.height=2*t;const i=o.getContext("2d");return i.strokeStyle=e,i.globalAlpha=.5,i.lineWidth=n,i.beginPath(),i.arc(t,t,t-n,0,d),i.stroke(),o}const ot=nt(50,"#fff",5),it=4290493371;function at(t){const e={text:{value:t,font:"arial",size:30,align:.5,color:it},x:50,y:35};return{children:[{image:ot},e],onTouchDown(t){0<t.x&&t.x<100&&0<t.y&&t.y<100&&this.onClick&&this.onClick()},setActive(t){e.text.color=t?4294967295:it}}}const st=150,ct=nt(st,"#fff",5),rt=nt(60,"#fff",5);function ht(){const t={image:ct},e={image:rt};t.x=-150,t.y=-150;let n=-1;return{children:[t,e],radius:st,value:p(),isActive:()=>-1!=n,onUpdate(){e.x=this.value.x*st-60,e.y=this.value.y*st-60},onTouchDown(t,e,o){-1===n&&m(t)<st&&(n=o,this.updateValue(t))},onTouchUp(t,e,o){n===o&&(n=-1,this.value.x=0,this.value.y=0,this.onChange&&this.onChange())},onTouchMove(t,e,o){n===o&&this.updateValue(t)},updateValue(t){this.value.x=t.x/st,this.value.y=t.y/st,m(this.value)>1&&b(this.value,1),this.onChange&&this.onChange()}}}const lt=30;function ut(t){const e=function(t){const e=ht(),n=ht(),o=at("gun"),i=at("rifle"),a=at("shot");e.visible=J,n.visible=J;const s=[o,i,a];return{moveJoystick:e,attackJoystick:n,gunButton:o,rifleButton:i,shotgunButton:a,children:[e,n,o,i,a],onUpdate(){const s=t.getWidth()/this.scale,c=t.getHeight()/this.scale;e.x=lt+e.radius,e.y=c-lt-e.radius,n.x=s-lt-n.radius,n.y=c-lt-n.radius,J?(a.x=s-lt-150,a.y=c-lt-2*n.radius-150,i.x=a.x-150,i.y=a.y+20,o.x=i.x-120,o.y=i.y+100):(a.x=s-lt-100,a.y=c-lt-100,i.x=a.x-100-lt,i.y=a.y,o.x=i.x-100-lt,o.y=i.y)},setActiveWeapon(t){"number"==typeof t&&(t=s[t]),s.forEach((e=>{e.setActive(e===t)}))}}}(t),n=et(e);return{children:[n,e],updateView(o){const i=t.getWidth(),a=t.getHeight(),s=r(i/1024,a/1024);n.scale=s,n.x=i/2,n.y=a/2,e.scale=s,n.updateCamera(o)}}}function dt(t,e,n){const o=e.a*t.a+e.b*t.c,i=e.a*t.b+e.b*t.d,a=e.c*t.a+e.d*t.c,s=e.c*t.b+e.d*t.d,c=e.x*t.a+e.y*t.c+t.x,r=e.x*t.b+e.y*t.d+t.y;n.a=o,n.b=i,n.c=a,n.d=s,n.x=c,n.y=r}function ft(t,e,n){let o=function(t){return t.a*t.d-t.b*t.c}(t);if(0===o)n.x=-t.x,n.y=-t.y;else{o=1/o;const{x:i,y:a}=e;n.x=o*(t.c*(t.y-a)+t.d*(i-t.x)),n.y=o*(t.a*(a-t.y)+t.b*(t.x-i))}}function yt(t,e){const{rotation:i}=t,a=t.scaleX??t.scale??1,s=t.scaleY??t.scale??1;if(e.x=t.x??0,e.y=t.y??0,i){const t=o(i),c=n(i);return e.a=t*a,e.b=c*a,e.c=-c*s,void(e.d=t*s)}e.a=a,e.b=0,e.c=0,e.d=s}const pt=p();function gt(t,e,n,o){t.onScreen=!1;if(!(t.visible??!0))return;const i={a:1,b:0,c:0,d:1,x:0,y:0};if(yt(t,i),dt(e,i,i),t.radius){const e=function(t){return s(a(t.a),a(t.b),a(t.c),a(t.d))}(i)*t.radius;if(i.x+e<0||i.y+e<0||i.x-e>o.canvas.width-0||i.y-e>o.canvas.height-0)return}const c={am:1,rm:1,gm:1,bm:1,ao:0,ro:0,go:0,bo:0};if(function(t,e){const n=t.alpha??1,{tint:o}=t;if(o){const{color:t=0,value:i=1}=o,a=1-i,s=t>>16&255,c=t>>8&255,r=255&t;return e.am=n,e.rm=a,e.gm=a,e.bm=a,e.ao=0,e.ro=s*i,e.go=c*i,void(e.bo=r*i)}let{brightness:i}=t;if(void 0!==i){i>1?i=1:i<-1&&(i=-1);const t=1-a(i);let o=0;return i>0&&(o=255*i),e.am=n,e.rm=t,e.gm=t,e.bm=t,e.ao=0,e.ro=o,e.go=o,void(e.bo=o)}e.am=n,e.rm=1,e.gm=1,e.bm=1,e.ao=0,e.ro=0,e.go=0,e.bo=0}(t,c),function(t,e,n){const o=t.am*e.am,i=t.rm*e.rm,a=t.gm*e.gm,s=t.bm*e.bm,c=t.am*e.ao+t.ao,r=t.rm*e.ro+t.ro,h=t.gm*e.go+t.go,l=t.bm*e.bo+t.bo;n.am=o,n.rm=i,n.gm=a,n.bm=s,n.ao=c,n.ro=r,n.go=h,n.bo=l}(n,c,c),c.am<=0)return;t.onScreen=!0,o.setTransform(i.a,i.b,i.c,i.d,i.x,i.y);const{shape:r,image:h,pallete:l,text:u,children:d}=t;r&&l&&function(t,e,n,o){for(let i=0;i<t.length;i++)switch(t[i]){case 0:o.fillStyle=v(e[t[++i]],n),o.fill();break;case 1:o.strokeStyle=v(e[t[++i]],n),o.lineWidth=t[++i],o.stroke();break;case 2:o.beginPath(),o.moveTo(t[++i],t[++i]);break;case 3:o.lineTo(t[++i],t[++i]);break;case 4:let a=t[++i];for(a--,o.beginPath(),o.moveTo(t[++i],t[++i]);a--;)o.lineTo(t[++i],t[++i]);break;default:throw`unknown command: ${t[i]}`}}(r,l,c,o),u&&function(t,e,n){if(!t.value)return;n.fillStyle=v(t.color??4278190080,e),n.font=`${t.size??10}px ${t.font??"arial"}`,n.textBaseline="top";let o=0;t.align&&(o=-n.measureText(t.value).width*t.align),n.fillText(t.value,o,0)}(u,c,o),h&&function(t,e,n){n.fillStyle=n.createPattern(t,"no-repeat"),n.fillRect(0,0,t.width,t.height)}(h,0,o),d&&d.forEach((t=>gt(t,i,c,o)))}function xt(t,e){if(!1===t.enabled)return;t.onUpdate&&t.onUpdate(e);const{children:n}=t;n&&n.forEach((t=>xt(t,e)))}function mt(t,e,n){switch(n){case 1:t.onKeyDown&&t.onKeyDown(e);break;case 0:t.onKeyUp&&t.onKeyUp(e)}const{children:o}=t;o&&o.forEach((t=>mt(t,e,n)))}function wt(t,e,n,o,i){if(!1===t.touchable)return;const a={a:1,b:0,c:0,d:1,x:0,y:0};switch(yt(t,a),dt(n,a,a),o){case 0:t.onTouchDown&&(ft(a,e,pt),t.onTouchDown(pt,e,i));break;case 1:t.onTouchUp&&(ft(a,e,pt),t.onTouchUp(pt,e,i));break;case 2:t.onTouchMove&&(ft(a,e,pt),t.onTouchMove(pt,e,i))}const{children:s}=t;s&&s.forEach((t=>wt(t,e,a,o,i)))}const bt={a:1,b:0,c:0,d:1,x:0,y:0},vt={am:1,rm:1,gm:1,bm:1,ao:0,ro:0,go:0,bo:0},kt=c,At=kt.getContext("2d");function Ct(t){!function(){const t=innerWidth*X|0,e=innerHeight*X|0;t!==kt.width&&(kt.width=t);e!==kt.height&&(kt.height=e);bt.a=bt.d=X}(),At.setTransform(),At.fillStyle="#bbbbbb",At.fillRect(0,0,kt.width,kt.height),gt(t,bt,vt,At)}let Tt,Ut=performance.now();function Mt(){requestAnimationFrame(Mt);const t=function(){const t=performance.now(),e=t-Ut;return Ut=t,e/1e3}();xt(Tt,t),Tt.updateView(t),Ct(Tt)}function St(){function t(t,e){mt(Tt,t,e),t.preventDefault()}if(Tt=ut({getWidth:()=>innerWidth,getHeight:()=>innerHeight}),Ut=performance.now(),Mt(),q.onkeydown=e=>t(e,1),q.onkeyup=e=>t(e,0),J){function t(t,e){const n=t.changedTouches;for(let t=0;t<n.length;t++){const{clientX:o,clientY:i,identifier:a}=n[t];wt(Tt,{x:o*X,y:i*X},bt,e,a)}t.preventDefault()}kt.ontouchstart=e=>t(e,0),kt.ontouchend=e=>t(e,1),kt.ontouchcancel=e=>t(e,1),kt.ontouchmove=e=>t(e,2)}else{function t(t,e){const n={x:t.clientX*X,y:t.clientY*X};wt(Tt,n,bt,e,0),t.preventDefault()}kt.onmousedown=e=>t(e,0),kt.onmousemove=e=>t(e,2),kt.onmouseup=e=>t(e,1),kt.onmouseleave=e=>t(e,1)}}!async function(){await async function(){const t=await fetch("r"),e=await t.arrayBuffer(),n=new Uint8Array(e);let o=0;for(;o<n.length;){const t=n[o++];H.push(e.slice(o,o+t)),o+=t}}(),St()}()}();
